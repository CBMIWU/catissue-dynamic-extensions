<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

	<property name="int.type" value="bigint(20)" dbms="mysql"/>
	<property name="int.type" value="number(19,0)" dbms="oracle"/>
	<property name="text.type" value="varchar(1000)" dbms="mysql"/>
	<property name="text.type" value="varchar2(1000)" dbms="oracle"/>
	<property name="clob.type" value="clob" dbms="oracle"/>
	<property name="clob.type" value="longtext" dbms="mysql"/>
	<property name="blob.type" value="blob" dbms="oracle"/>
	<property name="clob.type" value="longtext" dbms="mysql"/>
	<property name="string.type" value="varchar" dbms="mysql" />
	<property name="string.type" value="varchar2" dbms="oracle" />
        <property name="timestamp.type" value="timestamp" dbms="mysql" />
        <property name="timestamp.type" value="timestamp" dbms="oracle" />


	<changeSet id="1" author="kunal">
		<addColumn tableName="DYEXTN_ABSTRACT_RECORD_ENTRY">
			<column name="RECORD_ID" type="${int.type}" />
		</addColumn>
	</changeSet>
	<changeSet id="2" author="kunal">
		<createTable tableName="DYEXTN_CONTAINERS">
			<column name="IDENTIFIER" type="${int.type}">
				<constraints primaryKey="true" nullable="false"/>
			</column>

			<column name="NAME" type="${string.type}(400)">
			</column>

			<column name="CAPTION" type="${string.type}(400)">
			</column>

			<column name="CREATED_BY" type="${int.type}">
			</column>

			<column name="CREATE_TIME" type="${timestamp.type}">
			</column>

			<column name="LAST_MODIFIED_BY" type="${int.type}">
			</column>

			<column name="LAST_MODIFY_TIME" type="${timestamp.type}">
			</column>

			<column name="XML" type="${blob.type}">
			</column>
		</createTable>
		
	</changeSet>
	<changeSet id="3" author="kunal">
		<createSequence sequenceName = "DYEXTN_CONTAINERS_SEQ"/>
	</changeSet>

        <changeSet id="4" author="pawarv">
                <addColumn tableName="DYEXTN_ABSTRACT_FORM_CONTEXT">
			<column name="OLD_CONTAINER_ID" type="${int.type}"/>
                </addColumn>

                <sql>
                    update DYEXTN_ABSTRACT_FORM_CONTEXT set OLD_CONTAINER_ID = CONTAINER_ID
                </sql>              
        </changeSet>

	<changeSet id="5" author="pawarv">
		<createTable tableName="DYEXTN_VERSIONED_CONTAINERS">
			<column name="IDENTIFIER" type="${int.type}">
				<constraints nullable="false"/>
			</column>

			<column name="CONTAINER_ID" type="${int.type}">
				<constraints nullable="false"/>
			</column>

			<column name="ACTIVATION_DATE" type="${timestamp.type}">
			</column>

			<column name="CREATED_BY" type="${int.type}">
			</column>

			<column name="CREATE_TIME" type="${timestamp.type}">
			</column>

			<column name="STATUS" type="${string.type}(16)">
			</column>
		</createTable>

		<createSequence sequenceName = "DYEXTN_VERS_CONTAINERS_SEQ"/>

		<sql>
			insert into DYEXTN_ID_SEQ values('RECORD_ID_SEQ', 1)
		</sql>
	</changeSet>
	
	<changeSet id="6" author="ahegade">
		<createTable tableName="DYEXTN_FORMS">
			<column name="IDENTIFIER" type="${int.type}">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			
			<column name="FORM_NAME" type="${text.type}">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>
		
		<addForeignKeyConstraint constraintName="FK_VERS_CONTAINERS_ID"
		baseTableName="DYEXTN_VERSIONED_CONTAINERS" baseColumnNames="IDENTIFIER"
		referencedTableName="DYEXTN_FORMS" referencedColumnNames="IDENTIFIER"/>
		
		<createSequence sequenceName = "DYEXTN_FORMS_SEQ"/>
		
	</changeSet>
	

</databaseChangeLog>